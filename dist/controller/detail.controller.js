sap.ui.define(["sap/ui/core/mvc/Controller","../model/formatter","sap/m/PDFViewer","sap/ui/core/format/DateFormat","sap/ui/core/Fragment","sap/ui/core/util/File","sap/m/MessageBox","sap/ui/core/routing/History","sap/ui/core/UIComponent"],function(e,t,o,a,r,s,i,n,c){"use strict";return e.extend("com.ns.dmsfioriapp.controller.detail",{formatter:t,onInit(){var e=this;var t=sap.ui.core.UIComponent.getRouterFor(this);t.getRoute("detail").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){var t=this;this.sRepoPath=e.getParameter("arguments").productPath;var o="SPA_DMS/browser/"+this.sRepoPath+"/root/";$.ajax({url:o,type:"GET",dataType:"json",success:function(e){console.log(e);var o=new sap.ui.model.json.JSONModel({Array:e});t.getView().setModel(o,"detailModel");var a=[];for(let t=0;t<e.objects.length;t++){var r={objectTypeId:e.objects[t].object.properties["cmis:objectTypeId"].value,name:e.objects[t].object.properties["cmis:name"].value,createdBy:e.objects[t].object.properties["cmis:createdBy"].value,creationDate:e.objects[t].object.properties["cmis:creationDate"].value,lastModifiedBy:e.objects[t].object.properties["cmis:lastModifiedBy"].value,owner:e.objects[t].object.properties["sap:owner"].value};a.push(r)}var s=new sap.ui.model.json.JSONModel({dataArray:a});t.getView().setModel(s,"tableModel")},error:function(e){console.log(e)}})},onLinkPress:function(e){var t=this.getView().byId("DetailIdTable")._oItemNavigation.iFocusedIndex;var o=t-1;var a=this.getView().byId("DetailIdTable").getItems()[o].mAggregations.cells[2].mProperties.text;var r="SPA_DMS/browser/"+this.sRepoPath+"/root/"+""+a+"";window.open(r)},onCreateFolder:function(e){var t=this.getView();if(!this.byId("DialogId1")){r.load({id:t.getId(),name:"com.ns.dmsfioriapp.view.Folder",controller:this}).then(function(e){t.addDependent(e);e.open()})}else{this.byId("DialogId1").open()}},onSaveFolder:function(e){var t=this.getView().byId("Inp2").getValue();var o="SPA_DMS/browser/"+this.sRepoPath+"/root/";var a=new FormData;var r=this;a.append("cmisaction","createFolder");a.append("propertyId[0]","cmis:name");a.append("propertyValue[0]",t);a.append("propertyId[1]","cmis:objectTypeId");a.append("propertyValue[1]","cmis:folder");var s=new XMLHttpRequest;s.withCredentials=false;s.addEventListener("readystatechange",function(){if(this.readyState===this.DONE){sap.m.MessageBox.success("Folder Created Successfully");r.onRefresh()}});s.addEventListener("error",function(e){sap.m.MessageBox.error("Error creating folder: "+e)});s.open("POST",o);s.setRequestHeader("DataServiceVersion","2.0");s.setRequestHeader("Accept","application/json");s.send(a);this.byId("DialogId1").destroy()},onCloseFolder:function(e){this.byId("DialogId1").destroy()},onDelete:function(e){var t=this.getView().byId("DetailIdTable")._oItemNavigation.iFocusedIndex;var o=t-1;var a=this.getView().getModel("detailModel").oData.Array.objects[o].object.properties["cmis:objectId"].value;var r=this.sRepoPath;var s=this;var i="SPA_DMS/browser/"+r+"/root";var n={cmisaction:"delete",objectId:a,allVersions:true};$.ajax({type:"POST",url:i,data:$.param(n),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){console.log(e);sap.m.MessageBox.success("Deleted successfully");s.onRefresh()}.bind(s))},onRefresh:function(e){var t=this;var o="SPA_DMS/browser/"+this.sRepoPath+"/root/";$.ajax({url:o,type:"GET",dataType:"json",success:function(e){console.log(e);var o=new sap.ui.model.json.JSONModel({Array:e});t.getView().setModel(o,"detailModel");var a=[];for(let t=0;t<e.objects.length;t++){var r={objectTypeId:e.objects[t].object.properties["cmis:objectTypeId"].value,name:e.objects[t].object.properties["cmis:name"].value,createdBy:e.objects[t].object.properties["cmis:createdBy"].value,creationDate:e.objects[t].object.properties["cmis:creationDate"].value,lastModifiedBy:e.objects[t].object.properties["cmis:lastModifiedBy"].value,owner:e.objects[t].object.properties["sap:owner"].value};a.push(r)}var s=new sap.ui.model.json.JSONModel({dataArray:a});t.getView().setModel(s,"tableModel")},error:function(e){console.log(e)}})},onBack:function(){var e=n.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{var o=c.getRouterFor(this);o.navTo("detail/{productPath}",true)}},onClick1:function(e){var t=this.getView().byId("DetailIdTable")._oItemNavigation.iFocusedIndex;var o=t-1;var a=this.getView().byId("DetailIdTable").getItems()[o].mAggregations.cells[2].mProperties.text;var r=this.sRepoPath;var s=sap.ui.core.UIComponent.getRouterFor(this);s.navTo("files",{RepoID:r,folderNm:a})}})});
//# sourceMappingURL=detail.controller.js.map